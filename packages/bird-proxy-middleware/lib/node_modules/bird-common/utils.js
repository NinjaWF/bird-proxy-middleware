var npath = require('path')
var fs = require('fs')
var os = require('os')

var logColorsMapping = {
    'error': 'red',
    'info': 'blue',
    'hint': 'green',
    'warn': 'yellow',
    'debug': 'white'
}

var config

var utils = {
    log: function(type, message) {
        // 如果 config.debug == false 并且 type 不是 error, 则不打印信息
        if (config && config.debug === false && type != 'error' && type != 'warn') return;

        if (!arguments.length) {
            return
        }

        if (arguments.length < 2) {
            message = type
            type = 'info'
        }
        var prefix = '[' + type.toUpperCase() + ']'
        console.log(prefix[logColorsMapping[type]], message)
    },
    logs: function() {
        for (var i = 0; i < arguments.length; i++) {
            utils.log.apply(utils, arguments[i])
        }
    },
    stat: function(filePath) {
        if (!fs.existsSync(filePath)) {
            return {exist: false}
        } else {
            var stat = fs.statSync(filePath)
            stat.exist = true
            return stat;
        }
    },
    assignConfig: function(_config) {
        config = _config
    },
    getIP: function() {
        var ifaces = os.networkInterfaces();
        var IP;
        Object.keys(ifaces).forEach(function (ifname) {
            var alias = 0;
            ifaces[ifname].forEach(function (iface) {
                if ('IPv4' !== iface.family || iface.internal !== false) {
                  return;
                }

                if (alias >= 1) {
                  // this single interface has multiple ipv4 addresses
                    console.log(ifname + ':' + alias, iface.address);
                } else {
                  // this interface has only one ipv4 adress
                    IP = iface.address
                }
                ++alias;
            });
        });
        return IP;
    }
}

module.exports = utils;