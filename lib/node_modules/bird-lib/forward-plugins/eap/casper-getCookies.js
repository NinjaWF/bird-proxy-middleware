var targetUrl = '${targetUrl}';

const casper = require('casper').create();
casper.start(targetUrl);


casper.then(function () {

    this.wait(2000, function () {
        // TODO: 如果事件不够用了, 报出warning, 然后补时继续等待, 如果补时不够了, 就用报错, 并终止服务

        this.sendKeys('${userId}', '${username}');
        this.sendKeys('${userPassword}', '${password}');

        this.click('${submit}');
    }).then(function () {
        this.wait(3000, function () {
            // console.log(' ====================== COOKIE ======================= ');

            var cookies = this.page.cookies;
            // this.echo(cookies);
            var retResult = '';
            for (var i = cookies.length; i-- > 0;) {
                var cookie = cookies[i];
                if (cookie.name !== 'uss') {
                    retResult = retResult + cookie.name + '=' + cookie.value + ';';
                }
                // console.log(cookie.name, '=', cookie.value);

                // for (let key in cookie) {
                //     console.log(key, '=', cookie[key]);
                // }
            }
            console.log('cookie=', retResult);
        });
    })
});

casper.run();